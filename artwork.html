<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Artwork — Daria Avdeeva</title>
  <meta name="description" content="Artwork details page" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-neutral-50 text-neutral-900 antialiased">
  <header class="sticky top-0 z-30 bg-white/80 backdrop-blur border-b">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-9 h-9 rounded-full bg-neutral-900 text-white grid place-content-center font-semibold">DA</div>
        <a href="./index.html" class="text-lg font-semibold leading-tight">
          Daria <br class="sm:hidden"/> Avdeeva
        </a>
      </div>
      <nav class="flex items-center gap-4 text-sm overflow-x-auto whitespace-nowrap">
        <a href="./gallery.html" class="hover:opacity-70">All <br class="sm:hidden"/>Works</a>
        <a href="./about.html" class="hover:opacity-70">About <br class="sm:hidden"/>Daria</a>
        <a href="./commission.html" class="hover:opacity-70">Commission <br class="sm:hidden"/>Artwork</a>
      </nav>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 py-8 grid lg:grid-cols-2 gap-6 items-start">
    <!-- Carousel container (main image + controls + thumbs) -->
    <div class="rounded-2xl overflow-hidden shadow bg-neutral-200">
      <div class="relative">
        <img id="img" alt="Artwork image" class="w-full h-auto max-h-[80vh] object-contain transition-transform duration-300 mx-auto"/>
        <!-- Prev/Next controls (auto-hidden if no extra images) -->
        <button id="prev" class="hidden absolute left-2 top-1/2 -translate-y-1/2 rounded-full bg-white/80 hover:bg-white px-3 py-2 shadow text-xl" aria-label="Previous image">&larr;</button>
        <button id="next" class="hidden absolute right-2 top-1/2 -translate-y-1/2 rounded-full bg-white/80 hover:bg-white px-3 py-2 shadow text-xl" aria-label="Next image">&rarr;</button>
      </div>
      <div id="thumbs" class="hidden p-2 flex gap-2 overflow-x-auto bg-white/60"></div>
    </div>

    <div>
      <a href="./gallery.html" class="text-sm underline">← Back to all works</a>
      <h1 id="title" class="text-3xl font-bold mt-2"></h1>

      <!-- Labeled rows -->
      <dl id="metaRows" class="mt-3 grid grid-cols-1 gap-2 text-sm"></dl>

      <p id="price" class="mt-3 font-medium"></p>
      <p id="desc" class="mt-4 text-neutral-700 whitespace-pre-line"></p>

      <div class="mt-6 grid sm:grid-cols-2 gap-2">
        <a id="inquire" class="px-4 py-2 rounded-2xl bg-neutral-900 text-white text-center" target="_blank">Inquire</a>
        <a id="instagram" class="px-4 py-2 rounded-2xl border text-center" target="_blank">Instagram</a>
      </div>
    </div>
  </main>

  <!-- Load shared data FIRST -->
  <script src="./artworks.js"></script>

  <!-- Page script -->
  <script>
    function getParam(key){
      const url = new URL(window.location.href);
      return url.searchParams.get(key);
    }

    // helper: one labeled row (bold label, regular value)
    function row(label, value){
      if (!value && value !== 0) return "";
      return `
        <div class="grid grid-cols-[140px_1fr] gap-3">
          <dt class="font-semibold text-neutral-900">${label}:</dt>
          <dd class="font-normal text-neutral-700">${value}</dd>
        </div>
      `;
    }

    function renderArtwork(){
      const id = getParam('id');
      const a = (window.ARTWORKS || []).find(x => x.id === id);

      if (!a) {
        document.body.innerHTML = '<div class="max-w-2xl mx-auto p-6 text-center">Artwork not found. <a href="./gallery.html" class="underline">Back to all works</a></div>';
        return;
      }

      document.title = `${a.title} — ${window.ARTIST?.name || 'Artist'}`;

      const imgEl   = document.getElementById('img');
      const prevBtn = document.getElementById('prev');
      const nextBtn = document.getElementById('next');
      const thumbs  = document.getElementById('thumbs');

      // Main image
      imgEl.src = a.image;
      imgEl.alt = a.title || 'Artwork image';

      // With object-contain we ignore focal/zoom to preserve full image
      document.getElementById('title').textContent = a.title;.textContent = a.title;

      // Labeled meta rows
      const metaHTML = [
        row("Collection", a.collection),
        row("Medium", a.medium),
        row("Size in cm", a.size_cm),
        row("Size", a.size),
        row("Year", a.year),
        row("Location", a.location)
      ].join("");
      document.getElementById('metaRows').innerHTML = metaHTML;

      // Price already formatted like "AED 10,000" in artworks.js
      document.getElementById('price').textContent = a.price || 'AED —';

      // Description supports <strong>/<em> tags
      document.getElementById('desc').innerHTML = a.description || '';

      document.getElementById('inquire').href = `mailto:${window.ARTIST?.email}?subject=${encodeURIComponent('Inquiry: ' + (a.title || ''))}`;
      document.getElementById('instagram').href = `https://instagram.com/${(window.ARTIST?.instagram || '').replace('@','')}`;

      // ----------------------
      // Carousel logic
      // ----------------------
      const support = Array.isArray(a.support_images) ? a.support_images : [];
      const images = [a.image, ...support].filter(Boolean);

      if (images.length > 1) {
        // Show controls/strip
        prevBtn.classList.remove('hidden');
        nextBtn.classList.remove('hidden');
        thumbs.classList.remove('hidden');

        // Render thumbnails
        thumbs.innerHTML = images.map((src, i) => `
          <button class="relative w-16 h-16 shrink-0 rounded overflow-hidden border focus:outline-none focus:ring-2 focus:ring-neutral-900 ${i===0 ? 'ring-2 ring-neutral-900' : ''}" data-i="${i}" aria-label="Go to image ${i+1}">
            <img src="${src}" class="w-full h-full object-cover" alt="thumb ${i+1}">
          </button>
        `).join('');

        let index = 0;
        function setActive(i){
          index = (i + images.length) % images.length;
          imgEl.src = images[index];
          // keep optional focal/zoom only for the main image (index 0)
          if (index === 0) {
            if (a.focal) imgEl.style.objectPosition = a.focal; else imgEl.style.objectPosition = '';
            if (a.zoom) imgEl.style.transform = `scale(${a.zoom})`; else imgEl.style.transform = '';
          } else {
            imgEl.style.objectPosition = '';
            imgEl.style.transform = '';
          }
          // update thumb highlight
          [...thumbs.children].forEach((btn, n) => {
            btn.classList.toggle('ring-2', n === index);
            btn.classList.toggle('ring-neutral-900', n === index);
          });
        }

        prevBtn.addEventListener('click', () => setActive(index - 1));
        nextBtn.addEventListener('click', () => setActive(index + 1));
        thumbs.addEventListener('click', (e) => {
          const btn = e.target.closest('button[data-i]');
          if (btn) setActive(parseInt(btn.dataset.i, 10));
        });
      }
    }

    renderArtwork();
  </script>
</body>
</html>
